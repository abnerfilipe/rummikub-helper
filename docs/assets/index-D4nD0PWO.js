(function(){const a=document.createElement("link").relList;if(a&&a.supports&&a.supports("modulepreload"))return;for(const r of document.querySelectorAll('link[rel="modulepreload"]'))s(r);new MutationObserver(r=>{for(const i of r)if(i.type==="childList")for(const o of i.addedNodes)o.tagName==="LINK"&&o.rel==="modulepreload"&&s(o)}).observe(document,{childList:!0,subtree:!0});function n(r){const i={};return r.integrity&&(i.integrity=r.integrity),r.referrerPolicy&&(i.referrerPolicy=r.referrerPolicy),r.crossOrigin==="use-credentials"?i.credentials="include":r.crossOrigin==="anonymous"?i.credentials="omit":i.credentials="same-origin",i}function s(r){if(r.ep)return;r.ep=!0;const i=n(r);fetch(r.href,i)}})();const I={MIN_PLAYERS:2,MAX_PLAYERS:6},e={game:{players:[],rounds:[],currIdx:0,editingIdx:null,locked:!1,started:!1,tileDetails:{},roundWinners:{}},timer:{d:120,c:120,r:!1,i:null,s:!0},init(){const t=localStorage.getItem("rummi_v7_game");if(t&&(this.game=JSON.parse(t)),typeof this.game.currIdx>"u"&&(this.game.currIdx=0),typeof this.game.editingIdx>"u"&&(this.game.editingIdx=null),typeof this.game.locked>"u"&&(this.game.locked=!1),(typeof this.game.tileDetails>"u"||this.game.tileDetails===null||typeof this.game.tileDetails!="object"||Array.isArray(this.game.tileDetails))&&(this.game.tileDetails={}),(typeof this.game.roundWinners>"u"||this.game.roundWinners===null||typeof this.game.roundWinners!="object"||Array.isArray(this.game.roundWinners))&&(this.game.roundWinners={}),typeof this.game.started>"u"){const n=this.game.locked===!0||Array.isArray(this.game.rounds)&&this.game.rounds.length>0&&(this.game.currIdx>0||this.game.rounds[0].some(s=>s!==""&&s!==null));this.game.started=n,n&&(this.game.locked=!0)}const a=localStorage.getItem("rummi_v7_timer");if(a){const n=JSON.parse(a),s=typeof n.d=="number"?n.d:120,r=Math.round(s/60),i=Math.min(59,Math.max(2,r||2));this.timer.d=i*60,this.timer.s=n.s!==!1,this.timer.c=this.timer.d}else this.timer.d=120,this.timer.c=120;if(typeof this.game.turnIdx>"u"&&(this.game.turnIdx=0),typeof this.game.timeRule>"u"){const n=Math.round(this.timer.d/60);this.game.timeRule=n===1?"official":n===2?"alternative":"custom"}typeof this.game.turnAutoRotate>"u"&&(this.game.turnAutoRotate=!0),typeof this.game.confirmExpiry>"u"&&(this.game.confirmExpiry=!1),(typeof this.game.roundPenalties>"u"||this.game.roundPenalties===null||typeof this.game.roundPenalties!="object")&&(this.game.roundPenalties={}),Array.isArray(this.game.events)||(this.game.events=[]),(typeof this.game.turnHistory>"u"||this.game.turnHistory===null||typeof this.game.turnHistory!="object")&&(this.game.turnHistory={})},save(){localStorage.setItem("rummi_v7_game",JSON.stringify(this.game))},saveTimer(){localStorage.setItem("rummi_v7_timer",JSON.stringify({d:this.timer.d,s:this.timer.s}))},isGameStarted(){return this.game.started===!0},startGame(){this.game.started!==!0&&(this.game.started=!0,this.game.locked=!0,this.save())}},x={editingPlayerIdx:null,leaderboardExpanded:!1,leaderboardOpen:!1},L={ctx:null,init(){this.ctx||(this.ctx=new(window.AudioContext||window.webkitAudioContext)),this.ctx.state==="suspended"&&this.ctx.resume()},play(t,a,n){this.init();const s=this.ctx.createOscillator(),r=this.ctx.createGain();s.type=a,s.frequency.value=t,r.gain.setValueAtTime(.2,this.ctx.currentTime),r.gain.linearRampToValueAtTime(0,this.ctx.currentTime+n),s.connect(r),r.connect(this.ctx.destination),s.start(),s.stop(this.ctx.currentTime+n)},tick:()=>L.play(800,"sine",.1),alarm:()=>{L.init(),[0,.2,.4].forEach(t=>setTimeout(()=>L.play(880,"square",.1),t*1e3))}};function O(t,a=12){return t?t.length>a?t.substring(0,a-1)+"…":t:""}const v={updateUI(){const t=Math.floor(e.timer.c/60).toString().padStart(2,"0"),a=(e.timer.c%60).toString().padStart(2,"0"),n=document.getElementById("timerDisplay");n&&(n.innerText=`${t}:${a}`);const s=typeof e.game.turnIdx=="number"?e.game.turnIdx:0,r=e.game.players[s]||"",i=document.getElementById("currentPlayerName");i&&(i.innerText=O(r,12),i.title=r);const o=e.timer.d>0?e.timer.c/e.timer.d*100:100,l=document.getElementById("timerProgress");l&&(l.style.width=`${o}%`);const m=document.getElementById("timerContainer"),d=document.getElementById("timerProgress");e.timer.r&&e.timer.c<=15?(m.classList.add("timer-critical"),d.classList.replace("bg-orange-500","bg-red-600")):(m.classList.remove("timer-critical"),d.classList.replace("bg-red-600","bg-orange-500"))},start(){const t=document.getElementById("iconPlay"),a=document.getElementById("iconPause"),n=document.getElementById("btnToggleTimer");L.init(),e.timer.d!==0&&(e.timer.c<=0&&(e.timer.c=e.timer.d),e.timer.r=!0,t.classList.add("hidden"),a.classList.remove("hidden"),n.classList.replace("bg-orange-600","bg-slate-800"),e.timer.i=setInterval(()=>{e.timer.c--,v.updateUI(),e.timer.s&&e.timer.c<=10&&e.timer.c>0&&e.timer.c%2===0&&L.tick(),e.timer.c<=0&&(v.reset(),e.timer.s&&L.alarm(),v.handleExpiry())},1e3))},stop(){const t=document.getElementById("iconPlay"),a=document.getElementById("iconPause"),n=document.getElementById("btnToggleTimer");e.timer.r=!1,clearInterval(e.timer.i),t.classList.remove("hidden"),a.classList.add("hidden"),n.classList.replace("bg-slate-800","bg-orange-600"),document.getElementById("timerContainer").classList.remove("timer-critical")},toggle(){e.timer.r?v.stop():v.start()},handleExpiry(){const t=typeof e.game.turnIdx=="number"?e.game.turnIdx:0,a=e.game.players[t]||`Jogador ${t+1}`,n=e.game.timeRule||"official";let s=1;n==="official"?s=3:(n==="alternative"||n==="impatient")&&(s=1);const r=n==="official"?"Oficial":n==="alternative"?"Alternativa":n==="impatient"?"Variação":"Personalizado",i=()=>{e.game.roundPenalties||(e.game.roundPenalties={});const o=l;e.game.roundPenalties[o]||(e.game.roundPenalties[o]={}),e.game.roundPenalties[o][t]=(e.game.roundPenalties[o][t]||0)+s;const l=e.game.editingIdx!==null&&typeof e.game.editingIdx=="number"?e.game.editingIdx:e.game.currIdx,m=`${l}-${t}`;let d=!1;e.game.tileDetails&&e.game.tileDetails[m]&&(delete e.game.tileDetails[m],d=!0),e.save(),f.playersManager();const c=(t+1)%(e.game.players.length||1),h=e.game.players[c]||`Jogador ${c+1}`,u=`${a} estourou o tempo (${r}). Penalidade: +${s} peça(s). ${d?"Peças devolvidas.":"Sem peças registradas."} Próximo: ${h}.`;F(u),H(`[Rodada ${l+1}] ${u}`),B.rotateToNextPlayer(),e.game.turnAutoRotate&&(e.timer.c=e.timer.d,v.start())};if(e.game.confirmExpiry){const o=`${a} estourou o tempo (${r}). Ao confirmar, as peças jogadas (se registradas) serão devolvidas e o jogador comprará ${s} peça(s).`;A("Tempo Expirado",o,i);return}i()},reset(){e.timer.r=!1,clearInterval(e.timer.i),e.timer.c=e.timer.d,v.updateUI(),document.getElementById("iconPlay").classList.remove("hidden"),document.getElementById("iconPause").classList.add("hidden"),document.getElementById("btnToggleTimer").classList.replace("bg-slate-800","bg-orange-600"),document.getElementById("timerContainer").classList.remove("timer-critical")}},j={target:null,pendingWinner:null,roundWinnerAtOpen:null,counts:new Array(14).fill(0),values:(()=>{const t=[];for(let a=1;a<=13;a++)t.push(a);return t.push(30),t})(),open(t,a){this.target={rIdx:t,pIdx:a};const n=e.game.roundWinners?e.game.roundWinners[t]:null;this.roundWinnerAtOpen=typeof n=="number"?n:null,this.pendingWinner=this.roundWinnerAtOpen===a;const s=`${t}-${a}`,r=e.game.tileDetails?e.game.tileDetails[s]:null;Array.isArray(r)&&r.length===14?this.counts=r.map(i=>typeof i=="number"?i:0):this.counts=new Array(14).fill(0),this.render();for(let i=0;i<14;i++)this.updateTileCount(i);this.updateTotal(),this.updateHeader(),document.getElementById("tileCalcModal").classList.remove("hidden"),document.activeElement&&document.activeElement.blur&&document.activeElement.blur()},close(){document.getElementById("tileCalcModal").classList.add("hidden"),this.target=null,this.pendingWinner=null,this.roundWinnerAtOpen=null},isWinnerTarget(){if(!this.target)return!1;if(typeof this.pendingWinner=="boolean")return this.pendingWinner;const{rIdx:t,pIdx:a}=this.target,n=e.game.roundWinners?e.game.roundWinners[t]:null;return typeof n=="number"&&n===a},updateHeader(){if(!this.target)return;const{rIdx:t,pIdx:a}=this.target,n=document.getElementById("tileCalcTitle");n&&(n.textContent=`Resultado da rodada ${t+1}`);const s=document.getElementById("tileCalcSubtitle");s&&(s.textContent=e.game.players[a]||"");const r=document.getElementById("tileCalcWinnerBtn"),i=this.isWinnerTarget();if(r){r.className="p-2 rounded-xl border active:scale-95 transition-all "+(i?"border-yellow-300 bg-yellow-100 text-yellow-800":"border-yellow-200 text-slate-600 hover:text-yellow-900 hover:bg-yellow-50"),r.title=i?"Vencedor":"Marcar como vencedor",r.setAttribute("aria-label",i?"Vencedor":"Marcar como vencedor");const c=r.querySelector("#tileCalcWinnerLabel");c&&c.classList.toggle("hidden",!i)}const o=document.getElementById("tileCalcWinnerNotice");o&&o.classList.toggle("hidden",!i);const l=document.getElementById("tileCalcTotalLabel");l&&(l.textContent=i?"Vencedor":"Total");const m=document.getElementById("tileCalcTotalDesc");m&&(m.textContent=i?"Pontuação automática":"Lançado negativo");const d=document.getElementById("tileCalcGrid");d&&d.parentElement.classList.toggle("hidden",i),this.updateApplyBtnStyle()},updateApplyBtnStyle(){const t=document.getElementById("tileCalcApplyBtn");if(!t)return;t.disabled=!1;const a=Array.isArray(this.counts)?this.counts.some(s=>(s||0)>0):!1,n=this.isWinnerTarget();t.className="flex-1 py-3 rounded-xl shadow-lg inline-flex items-center justify-center gap-2 font-black "+(a||n?"bg-orange-500 text-white hover:bg-orange-600":"bg-slate-100 text-slate-700 hover:bg-slate-200")},toggleWinner(){this.target&&(this.pendingWinner=!this.isWinnerTarget(),this.updateHeader())},inc(t){typeof this.counts[t]!="number"&&(this.counts[t]=0),this.counts[t]=Math.min(99,this.counts[t]+1),this.updateTileCount(t),this.updateTotal()},dec(t){typeof this.counts[t]!="number"&&(this.counts[t]=0),this.counts[t]=Math.max(0,this.counts[t]-1),this.updateTileCount(t),this.updateTotal()},sum(){let t=0;for(let a=0;a<this.counts.length;a++){const n=this.counts[a]||0;t+=n*this.values[a]}return t},total(){return-this.sum()},updateTotal(){const t=document.getElementById("tileCalcTotal");if(!t)return;if(this.isWinnerTarget()){t.textContent="Auto",t.className="text-2xl font-black tabular-nums text-yellow-800",this.updateApplyBtnStyle();return}const a=this.total();t.textContent=a>0?`+${a}`:`${a}`,t.className="text-2xl font-black tabular-nums "+(a<0?"text-rose-600":a>0?"text-emerald-600":"text-slate-600"),this.updateApplyBtnStyle()},updateTileCount(t){const a=document.getElementById(`tileCount-${t}`);if(!a)return;const n=this.counts[t]||0;a.textContent=n;const s=t===13,r=n>0,i=document.getElementById(`tileCard-${t}`);i&&(i.className="rounded-2xl border bg-white p-2 transition-colors "+(r?"border-orange-200":"border-slate-200"));const o=document.getElementById(`tileLabel-${t}`);o&&(o.className="w-8 h-8 rounded-xl flex items-center justify-center transition-colors "+(r?"bg-orange-500 text-white":"bg-slate-100 text-slate-800")+(s?"":" font-black"));const l=document.getElementById(`tileBadge-${t}`);l&&(l.className="inline-flex items-center gap-1 px-2 py-1 rounded-full text-xs font-black shrink-0 transition-colors "+(n>0?"bg-orange-100 text-orange-800":"bg-slate-100 text-slate-700"));const m=document.getElementById(`tileDec-${t}`);m&&(m.className="flex-1 h-9 rounded-xl font-black active:scale-95 transition-colors "+(r?"bg-rose-100 text-rose-700 hover:bg-rose-200":"bg-slate-100 text-slate-700 hover:bg-slate-200"));const d=document.getElementById(`tileInc-${t}`);d&&(d.className="flex-1 h-9 rounded-xl font-black active:scale-95 transition-colors "+(r?"bg-orange-500 text-white hover:bg-orange-600":"bg-slate-100 text-slate-700 hover:bg-slate-200"))},render(){const t=document.getElementById("tileCalcGrid");if(!t)return;let a="";for(let n=0;n<14;n++)a+="...";t.innerHTML=a;try{const n=document.createTreeWalker(t,NodeFilter.SHOW_TEXT,null,!1),s=[];for(;n.nextNode();){const r=n.currentNode;r&&typeof r.textContent=="string"&&/id="/.test(r.textContent)&&s.push(r)}s.forEach(r=>r.parentNode&&r.parentNode.removeChild(r)),s.length&&console.warn("Removed",s.length,"stray text nodes from tileCalcGrid")}catch(n){console.warn("Error cleaning tileCalcGrid text nodes",n)}},apply(){if(!this.target)return;const{rIdx:t,pIdx:a}=this.target,n=document.getElementById(`cell-${t}-${a}`);if(!n){this.close();return}const s=e.game.roundWinners&&typeof e.game.roundWinners[t]=="number"?e.game.roundWinners[t]:null;if(this.isWinnerTarget()){if(e.game.roundWinners||(e.game.roundWinners={}),typeof s=="number"&&s!==a){const o=document.getElementById(`cell-${t}-${s}`);o?(o.value="",B.applyScoreValue(t,s,o,"",{skipRecalc:!0})):e.game.rounds[t][s]=""}e.game.roundWinners[t]=a,n.value="0",B.applyScoreValue(t,a,n,"0",{skipRecalc:!0}),e.save(),B.recalculateWinnerForRound(t),f.totals(),f.leaderboard(),this.close();return}s===a&&(delete e.game.roundWinners[t],n.value="",B.applyScoreValue(t,a,n,"",{skipRecalc:!0}));const i=this.total().toString();n.value=i,B.applyScoreValue(t,a,n,i,{tileCounts:this.counts.slice(0,14)}),this.close()}};function V(t){return t==null?"":String(t).replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&#39;")}const f={all(){this.table(),this.totals(),this.updateAddPlayerState(),this.actionButton(),this.leaderboard(),this.playersManager()},playersManager(){document.getElementById("playersManager")},eventLog(){const t=document.getElementById("eventLogList");if(!t)return;const a=Array.isArray(e.game.events)?e.game.events:[];if(a.length===0){t.innerHTML='<div class="text-sm text-slate-500">Nenhum evento registrado.</div>';return}t.innerHTML=a.map(n=>`<div class="p-2 rounded-lg bg-slate-50 border border-slate-100"><div class="text-[11px] text-slate-400">${new Date(n.ts).toLocaleString()}</div><div class="mt-1 text-sm text-slate-700">${V(n.msg)}</div></div>`).join("")},pendingPenalties(){const t=document.getElementById("pendingPenaltiesList");if(!t)return;const a=e.game.editingIdx!==null&&typeof e.game.editingIdx=="number"?e.game.editingIdx:e.game.currIdx,n=e.game.turnHistory&&e.game.turnHistory[a]?e.game.turnHistory[a]:{},s=[];if(Object.keys(n).forEach(r=>{(n[r]||[]).forEach((o,l)=>{o.penaltyApplied>0&&o.penaltyConfirmed===null&&s.push({pid:parseInt(r,10),idx:l,entry:o})})}),s.length===0){t.innerHTML='<div class="text-sm text-slate-500">Nenhuma penalidade pendente nesta rodada.</div>';return}t.innerHTML=s.map(r=>{const i=e.game.players[r.pid]||`Jogador ${r.pid+1}`;return`<div class="p-3 rounded-lg border border-slate-100 bg-slate-50"><div class="text-xs text-slate-400">${new Date(r.entry.start).toLocaleString()} — ${new Date(r.entry.end).toLocaleString()}</div><div class="mt-1 text-sm text-slate-800">${i} — Penalidade aplicada: +${r.entry.penaltyApplied}</div><div class="mt-2 flex gap-2"><button onclick="Actions.confirmPendingPenalty(${a}, ${r.pid}, ${r.idx}, true)" class="px-3 py-2 rounded-lg bg-emerald-600 text-white">Confirmar</button><button onclick="Actions.confirmPendingPenalty(${a}, ${r.pid}, ${r.idx}, false)" class="px-3 py-2 rounded-lg bg-rose-600 text-white">Rejeitar</button></div></div>`}).join("")},playerHistory(t){const a=document.getElementById("playerHistoryList");if(!a)return;const n=[],s=e.game.turnHistory||{};Object.keys(s).forEach(u=>{const g=parseInt(u,10);(s[g]&&s[g][t]?s[g][t]:[]).forEach(p=>{n.push({rIdx:g,entry:p})})});const r=n.length,i=n.reduce((u,g)=>u+(g.entry.durationSeconds||0),0),o=r>0?Math.round(i/r):0,l=n.reduce((u,g)=>u+(g.entry.penaltyApplied||0),0),m=n.reduce((u,g)=>u+(g.entry.penaltyConfirmed===!0&&g.entry.penaltyApplied?g.entry.penaltyApplied:0),0),d=n.reduce((u,g)=>u+(g.entry.penaltyConfirmed===null&&g.entry.penaltyApplied?g.entry.penaltyApplied:0),0),c=u=>{if(u<60)return`${u}s`;const g=Math.floor(u/60),b=u%60;return`${g}m ${b}s`};if(n.length===0){a.innerHTML='<div class="text-sm text-slate-500">Nenhum histórico disponível para este jogador.</div>';return}const h=`<div class="p-3 rounded-lg border border-slate-100 bg-white mb-3">
        <div class="flex items-center justify-between gap-4">
          <div>
            <div class="text-sm text-slate-500">Total de turnos</div>
            <div class="text-lg font-black text-slate-800">${r}</div>
          </div>
          <div>
            <div class="text-sm text-slate-500">Tempo total</div>
            <div class="text-lg font-black text-slate-800">${c(i)}</div>
          </div>
          <div>
            <div class="text-sm text-slate-500">Tempo médio</div>
            <div class="text-lg font-black text-slate-800">${c(o)}</div>
          </div>
          <div>
            <div class="text-sm text-slate-500">Penalidades (peças)</div>
            <div class="text-lg font-black text-rose-600">${l}</div>
          </div>
          <div>
            <div class="text-sm text-slate-500">Confirmadas / Pendentes</div>
            <div class="text-lg font-black text-slate-700">${m} / ${d}</div>
          </div>
        </div>
      </div>`;a.innerHTML=h+n.sort((u,g)=>u.rIdx-g.rIdx).map(u=>{const g=u.entry,b=`${new Date(g.start).toLocaleString()} — ${new Date(g.end).toLocaleString()}`,p=`${g.durationSeconds}s`,y=g.penaltyApplied>0?`<span class="text-rose-600 font-bold">+${g.penaltyApplied}</span>`:'<span class="text-slate-400">—</span>',E=g.penaltyApplied>0?g.penaltyConfirmed===null?'<em class="text-slate-500">(pendente)</em>':g.penaltyConfirmed?'<span class="text-emerald-600 font-bold">(confirmada)</span>':'<span class="text-rose-600 font-bold">(rejeitada)</span>':"";return`<div class="p-3 rounded-lg border border-slate-100 bg-slate-50"><div class="text-xs text-slate-400">Rodada ${u.rIdx+1} — ${b}</div><div class="mt-1 text-sm text-slate-800">Duração: ${p} — Penalidade: ${y} ${E}</div></div>`}).join("")},updateAddPlayerState(){const t=document.getElementById("addPlayerSection"),a=document.getElementById("addPlayerSectionPlayersWrap"),n=document.getElementById("gameStatusPill"),s=document.getElementById("newPlayerName"),r=document.getElementById("newPlayerNamePlayers"),i=document.getElementById("addPlayerBtn"),o=document.getElementById("addPlayerBtnPlayers"),l=Array.isArray(e.game.players)&&e.game.players.length>=I.MAX_PLAYERS,m=e.isGameStarted(),d=m&&e.game&&e.game.currIdx>=e.game.rounds.length;m?(t&&t.classList.add("hidden"),a&&a.classList.add("hidden"),s instanceof HTMLInputElement&&(s.disabled=!0),r instanceof HTMLInputElement&&(r.disabled=!0),i instanceof HTMLButtonElement&&(i.disabled=!0),o instanceof HTMLButtonElement&&(o.disabled=!0),n&&(n.classList.remove("hidden"),d?(n.className="px-2.5 py-1 rounded-full bg-emerald-50 border border-emerald-100 text-emerald-700 text-xs font-black inline-flex items-center gap-1.5",n.title="Jogo finalizado",n.innerHTML=`
            <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="2.5" stroke="currentColor" class="w-4 h-4">
              <path stroke-linecap="round" stroke-linejoin="round" d="M9 12.75L11.25 15 15 9.75M21 12a9 9 0 11-18 0 9 9 0 0118 0z" />
            </svg>
            <span class="hidden sm:inline">Jogo finalizado</span>
            <span class="sm:hidden">Final</span>
          `):(n.className="px-2.5 py-1 rounded-full bg-orange-50 border border-orange-100 text-orange-700 text-xs font-black inline-flex items-center gap-1.5",n.title="Partida em andamento",n.innerHTML=`
            <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="2.5" stroke="currentColor" class="w-4 h-4">
              <path stroke-linecap="round" stroke-linejoin="round" d="M16.5 10.5V6.75a4.5 4.5 0 10-9 0v3.75M6.75 10.5h10.5a1.5 1.5 0 011.5 1.5v7.5a1.5 1.5 0 01-1.5 1.5H6.75a1.5 1.5 0 01-1.5-1.5V12a1.5 1.5 0 011.5-1.5z" />
            </svg>
            <span class="hidden sm:inline">Partida em andamento</span>
            <span class="sm:hidden">Em jogo</span>
          `))):(t&&t.classList.remove("hidden"),a&&a.classList.remove("hidden"),n&&n.classList.add("hidden"),s instanceof HTMLInputElement&&(s.disabled=l,s.placeholder=l?`Limite de ${I.MAX_PLAYERS} jogadores atingido`:"Nome do jogador...",s.classList.toggle("bg-slate-50",l),s.classList.toggle("opacity-70",l)),r instanceof HTMLInputElement&&(r.disabled=l,r.placeholder=l?`Limite de ${I.MAX_PLAYERS} jogadores atingido`:"Nome do jogador...",r.classList.toggle("bg-slate-50",l),r.classList.toggle("opacity-70",l)),i instanceof HTMLButtonElement&&(i.disabled=l,i.classList.toggle("opacity-50",l),i.classList.toggle("cursor-not-allowed",l),i.title=l?`Limite de ${I.MAX_PLAYERS} jogadores atingido`:"Adicionar jogador"),o instanceof HTMLButtonElement&&(o.disabled=l,o.classList.toggle("opacity-50",l),o.classList.toggle("cursor-not-allowed",l),o.title=l?`Limite de ${I.MAX_PLAYERS} jogadores atingido`:"Adicionar jogador"))},table(){const t=document.getElementById("emptyState"),a=document.getElementById("tableContainer"),n=document.getElementById("leaderboardBar");if(e.game.players.length===0){t.classList.remove("hidden"),a.classList.add("hidden"),n.classList.add("hidden");return}t.classList.add("hidden"),a.classList.remove("hidden"),n.classList.remove("hidden");let s='<th class="py-3 px-2 w-[50px] sticky left-0 z-20 bg-slate-50 border-r border-slate-200 text-center font-bold text-slate-400">Rodada</th>';e.game.players.forEach(d=>s+=`<th class="py-3 px-2 min-w-[90px] text-center font-bold text-slate-700 truncate max-w-[110px]">${d}</th>`);const r=document.getElementById("headerRow");r&&(r.innerHTML=s);let i="";e.game.rounds.forEach((d,c)=>{const h=e.game.editingIdx===c,u=e.game.currIdx===c&&e.game.editingIdx===null,g=c<e.game.currIdx;let b="border-b border-slate-100 ",p="sticky left-0 z-10 py-2 border-r border-slate-200 text-center ",y="readonly";h?(b+="editing-round-row",p+="bg-orange-50",y=""):u?(b+="active-round-row",p+="bg-white",y=e.isGameStarted()?"":"readonly"):g?(b+="inactive-round-row",p+="bg-slate-50"):(b+="bg-white opacity-50",p+="bg-white");let E=`<span class="block text-xs font-mono font-bold text-slate-300">${c+1}</span>`;h?E='<span class="text-orange-600 font-bold text-xs">Edit</span>':u?e.game.editingIdx!==null?(E='<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor" class="w-3 h-3 text-slate-300 mx-auto"><path fill-rule="evenodd" d="M10 1a4.5 4.5 0 00-4.5 4.5V9H5a2 2 0 00-2 2v6a2 2 0 002 2h10a2 2 0 002-2v-6a2 2 0 00-2-2h-.5V5.5A4.5 4.5 0 0010 1zm3 8V5.5a3 3 0 10-6 0V9h6z" clip-rule="evenodd" /></svg>',y="readonly",b=b.replace("active","inactive")):E=`<span class="block text-xs font-mono font-bold text-orange-600">${c+1}</span>`:g&&e.game.editingIdx===null&&(E=`<button onclick="Actions.enableEdit(${c})" class="mx-auto text-slate-300 hover:text-blue-500"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor" class="w-3.5 h-3.5"><path d="M5.433 13.917l1.262-3.155A4 4 0 017.58 9.42l6.92-6.918a2.121 2.121 0 013 3l-6.92 6.918c-.383.383-.84.685-1.343.886l-3.154 1.262a.5.5 0 01-.65-.65z" /><path d="M3.5 5.75c0-.69.56-1.25 1.25-1.25H10A.75.75 0 0010 3H4.75A2.75 2.75 0 002 5.75v9.5A2.75 2.75 0 004.75 18h9.5A2.75 2.75 0 0017 15.25V10a.75.75 0 00-1.5 0v5.25c0 .69-.56 1.25-1.25 1.25h-9.5c-.69 0-1.25-.56-1.25-1.25v-9.5z" /></svg></button>`),i+=`<tr class="${b}"><td class="${p}">${E}</td>`,Array.isArray(d)&&d.forEach((k,$)=>{const M=e.game.roundWinners||{},P=typeof M[c]=="number"&&M[c]===$,T=parseInt(k);let S="text-slate-800";isNaN(T)||(S=T>0?"text-emerald-600":T<0?"text-rose-600":P?"text-emerald-600":"text-slate-400");const D=h||u&&e.isGameStarted()?"focus:ring-2 focus:ring-inset focus:ring-orange-500 bg-orange-50/10":"focus:ring-0";i+=`<td class="p-0 border-r border-slate-100 last:border-0 relative h-[52px]">${P?`<div class="absolute top-1 left-1 w-6 h-6 rounded-lg bg-yellow-50 border border-yellow-200 flex items-center justify-center text-yellow-800 pointer-events-none">
                      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor" class="w-4 h-4" aria-hidden="true">
                        <path d="M10 2a.75.75 0 01.75.75v.846a4.5 4.5 0 003.66 4.411.75.75 0 01.64.74v1.003a4.5 4.5 0 01-3.155 4.29l-.695.232a.75.75 0 00-.51.711V16.5h1.5a.75.75 0 010 1.5h-5a.75.75 0 010-1.5h1.5v-1.525a.75.75 0 00-.51-.711l-.695-.232A4.5 4.5 0 015.5 9.75V8.747a.75.75 0 01.64-.74 4.5 4.5 0 003.66-4.411V2.75A.75.75 0 0110 2z" />
                        <path d="M4.5 5.75a.75.75 0 00-1.5 0v2A2.75 2.75 0 005.75 10.5h.392a6.023 6.023 0 01-.439-1.5H5.75A1.25 1.25 0 014.5 7.75v-2zM15.5 5.75a.75.75 0 011.5 0v2a2.75 2.75 0 01-2.75 2.75h-.392c.216-.48.364-.98.439-1.5h-.047A1.25 1.25 0 0015.5 7.75v-2z" />
                      </svg>
                    </div>`:""}<input id="cell-${c}-${$}" type="tel" inputmode="decimal" class="w-full h-full text-center text-lg font-bold bg-transparent outline-none transition-all ${S} ${D} placeholder-slate-200" value="${k}" placeholder="-" ${y} onfocus="this.select()" onclick="Actions.openTileCalc(${c}, ${$})" oninput="Actions.handleInput(${c}, ${$}, this)"></td>`}),i+="</tr>"});const o=document.getElementById("tableBody");o&&(o.innerHTML=i);let l='<td class="py-4 px-2 sticky left-0 z-20 bg-slate-900 border-r border-slate-700 text-center font-bold text-xs uppercase text-slate-300">Total</td>';e.game.players.forEach((d,c)=>l+=`<td id="total-${c}" class="text-center font-black text-lg py-3 text-slate-400">0</td>`);const m=document.getElementById("totalRow");m&&(m.innerHTML=l)},totals(){let t=new Array(e.game.players.length).fill(0);return Array.isArray(e.game.rounds)&&e.game.rounds.forEach(n=>{if(!Array.isArray(n))return;n.forEach((r,i)=>{const o=parseInt(r);isNaN(o)||(t[i]+=o)})}),t.forEach((a,n)=>{const s=document.getElementById(`total-${n}`);s&&(s.innerText=a>0?`+${a}`:a,s.className=`text-center font-black text-lg py-3 ${a>0?"text-emerald-400":a<0?"text-rose-400":"text-slate-500"}`)}),t},leaderboard(){const a=this.totals().map((p,y)=>({n:e.game.players[y],s:p,i:y})).sort((p,y)=>y.s-p.s),n=document.getElementById("leaderboardList"),s=document.getElementById("leaderboardToggleBtn"),r=document.getElementById("leaderboardBody"),i=document.getElementById("leaderboardChevron");if(!n)return;let o="";const l=e.game.editingIdx!==null&&typeof e.game.editingIdx=="number"?e.game.editingIdx:e.game.currIdx,m=e.game.roundWinners&&typeof e.game.roundWinners[l]=="number"?e.game.roundWinners[l]:null,d=a.length>3,c=x.leaderboardExpanded===!0,h=x.leaderboardOpen===!0;if(r&&r.classList.toggle("hidden",!h),i&&(i.innerHTML=h?`<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor" class="w-4 h-4">
                   <path fill-rule="evenodd" d="M14.77 12.79a.75.75 0 01-1.06-.02L10 8.832l-3.71 3.938a.75.75 0 11-1.08-1.04l4.24-4.5a.75.75 0 011.08 0l4.24 4.5a.75.75 0 01-.02 1.06z" clip-rule="evenodd" />
                 </svg>`:`<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor" class="w-4 h-4">
                   <path fill-rule="evenodd" d="M5.23 7.21a.75.75 0 011.06.02L10 11.168l3.71-3.938a.75.75 0 111.08 1.04l-4.24 4.5a.75.75 0 01-1.08 0l-4.24-4.5a.75.75 0 01.02-1.06z" clip-rule="evenodd" />
                 </svg>`),!h){n.innerHTML="",s&&s.classList.add("hidden");return}const u=c||!d,g=u?a:a.slice(0,3);s&&(d?(s.classList.remove("hidden"),s.title=u?"Mostrar menos":"Ver todos",s.innerHTML=u?`<span class="sr-only">Mostrar menos</span>
                   <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor" class="w-4 h-4" aria-hidden="true">
                     <path fill-rule="evenodd" d="M4.293 4.293a1 1 0 011.414 0L10 8.586l4.293-4.293a1 1 0 111.414 1.414L11.414 10l4.293 4.293a1 1 0 01-1.414 1.414L10 11.414l-4.293 4.293a1 1 0 01-1.414-1.414L8.586 10 4.293 5.707a1 1 0 010-1.414z" clip-rule="evenodd" />
                   </svg>`:`<span class="sr-only">Ver todos</span>
                   <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor" class="w-4 h-4" aria-hidden="true">
                     <path fill-rule="evenodd" d="M3 5.75A.75.75 0 013.75 5h12.5a.75.75 0 010 1.5H3.75A.75.75 0 013 5.75zM3 10a.75.75 0 01.75-.75h12.5a.75.75 0 010 1.5H3.75A.75.75 0 013 10zm0 4.25a.75.75 0 01.75-.75h12.5a.75.75 0 010 1.5H3.75a.75.75 0 01-.75-.75z" clip-rule="evenodd" />
                   </svg>`):(s.classList.add("hidden"),x.leaderboardExpanded=!1)),u?n.className="flex flex-col gap-1 max-h-44 overflow-y-auto pr-1 -mr-1":n.className="flex gap-2 overflow-x-auto hide-scrollbar py-0.5";const b='<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor" class="w-4 h-4 trophy-icon trophy-icon" aria-hidden="true"><path d="M10 2a.75.75 0 01.75.75v.846a4.5 4.5 0 003.66 4.411.75.75 0 01.64.74v1.003a4.5 4.5 0 01-3.155 4.29l-.695.232a.75.75 0 00-.51.711V16.5h1.5a.75.75 0 010 1.5h-5a.75.75 0 010-1.5h1.5v-1.525a.75.75 0 00-.51-.711l-.695-.232A4.5 4.5 0 015.5 9.75V8.747a.75.75 0 01.64-.74 4.5 4.5 0 003.66-4.411V2.75A.75.75 0 0110 2z" /><path d="M4.5 5.75a.75.75 0 00-1.5 0v2A2.75 2.75 0 005.75 10.5h.392a6.023 6.023 0 01-.439-1.5H5.75A1.25 1.25 0 014.5 7.75v-2zM15.5 5.75a.75.75 0 011.5 0v2a2.75 2.75 0 01-2.75 2.75h-.392c.216-.48.364-.98.439-1.5h-.047A1.25 1.25 0 0015.5 7.75v-2z" /></svg>';g.forEach((p,y)=>{const E=y===0,$=E?"bg-yellow-100 border-yellow-200 text-yellow-800":y===1?"bg-slate-100 border-slate-200 text-slate-700":y===2?"bg-orange-100 border-orange-200 text-orange-800":"bg-slate-100 border-slate-200 text-slate-600",M=typeof m=="number"&&m===p.i,P=p.s>0?"text-emerald-600":p.s<0?"text-rose-600":M?"text-emerald-600":"text-slate-400",T=p.s>0||p.s===0&&M?"+":"",S=E?b:`<span class="text-xs font-black tabular-nums">${y+1}</span>`;u?o+=`
                <div class="w-full rounded-lg border border-slate-200 bg-white px-2 py-1.5">
                  <div class="flex items-center justify-between gap-3">
                    <div class="flex items-center gap-2 min-w-0">
                      <div class="w-6 h-6 rounded-md border ${$} flex items-center justify-center shrink-0">
                        ${S}
                      </div>
                      <div class="text-xs font-bold text-slate-800 truncate min-w-0">${p.n}</div>
                    </div>
                    <div class="text-xs font-black tabular-nums ${P}">${T}${p.s}</div>
                  </div>
                </div>
              `:o+=`
                <div class="shrink-0 rounded-lg border border-yellow-100 bg-white/70 px-2 py-1">
                  <div class="flex items-center gap-2">
                    <div class="w-6 h-6 rounded-md border ${$} flex items-center justify-center">
                      ${S}
                    </div>
                    <div class="text-xs font-black text-slate-800 max-w-[120px] truncate">${p.n}</div>
                    <div class="text-xs font-black tabular-nums ${P}">${T}${p.s}</div>
                  </div>
                </div>
              `}),n.innerHTML=o},actionButton(){const t=document.getElementById("smartActionBtn");if(!(!t||!(t instanceof HTMLButtonElement))){if(e.game.players.length===0){t.classList.add("hidden");return}if(t.classList.remove("hidden"),e.game.editingIdx!==null){t.classList.replace("bg-emerald-600","bg-slate-900"),t.classList.replace("bg-orange-600","bg-slate-900"),t.disabled=!1,t.innerHTML='<div class="bg-slate-800 p-1.5 rounded-lg group-hover:bg-slate-700 transition-colors"><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" class="w-5 h-5 text-orange-400"><path stroke-linecap="round" stroke-linejoin="round" d="M16.862 4.487l1.687-1.688a1.875 1.875 0 112.652 2.652L10.582 16.07a4.5 4.5 0 01-1.897 1.13L6 18l.8-2.685a4.5 4.5 0 011.13-1.897l8.932-8.931z" /><path stroke-linecap="round" stroke-linejoin="round" d="M19.5 7.125L16.862 4.487" /></svg></div><span class="text-lg">Salvar Alterações</span>';return}if(!e.isGameStarted()){t.classList.replace("bg-emerald-600","bg-slate-900"),t.classList.replace("bg-slate-900","bg-orange-600"),t.disabled=e.game.players.length<I.MIN_PLAYERS,t.innerHTML='<span class="text-lg">Iniciar Rodada</span>';return}e.game.currIdx>=e.game.rounds.length?(t.classList.replace("bg-slate-900","bg-emerald-600"),t.classList.replace("bg-orange-600","bg-emerald-600"),t.innerHTML="<span>Jogo Finalizado</span>",t.disabled=!1):(t.classList.replace("bg-emerald-600","bg-slate-900"),t.disabled=!1,t.innerHTML='<div class="bg-slate-800 p-1.5 rounded-lg group-hover:bg-slate-700 transition-colors"><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" class="w-5 h-5 text-orange-400"><path stroke-linecap="round" stroke-linejoin="round" d="M15.75 15.75l-2.489-2.489m0 0a3.375 3.375 0 10-4.773-4.773 3.375 3.375 0 004.774 4.774zM21 12a9 9 0 11-18 0 9 9 0 0118 0z" /></svg></div><span class="text-lg">Concluir Rodada</span>')}}};typeof window<"u"&&(window.Render=f);const B={movePlayerUp(t){this.movePlayer(t,-1)},movePlayerDown(t){this.movePlayer(t,1)},movePlayer(t,a){if(e.isGameStarted()){w("A partida já começou. Para reordenar jogadores, reinicie o jogo.");return}if(!Array.isArray(e.game.players))return;const n=Number(t);if(!Number.isInteger(n))return;const s=n+Number(a);if(!Number.isInteger(s)||s<0||s>=e.game.players.length||n===s)return;const r=e.game.players[n];if(e.game.players[n]=e.game.players[s],e.game.players[s]=r,Array.isArray(e.game.rounds)&&e.game.rounds.forEach(i=>{if(!Array.isArray(i))return;const o=i[n];i[n]=i[s],i[s]=o}),e.game.tileDetails&&typeof e.game.tileDetails=="object"){const i=e.game.tileDetails,o=Array.isArray(e.game.rounds)?e.game.rounds.length:0;for(let l=0;l<o;l++){const m=`${l}-${n}`,d=`${l}-${s}`,c=i[m],h=i[d];if(!(typeof c>"u"&&typeof h>"u")){if(typeof h>"u"){delete i[m],i[d]=c;continue}if(typeof c>"u"){delete i[d],i[m]=h;continue}i[m]=h,i[d]=c}}}if(e.game.roundWinners&&typeof e.game.roundWinners=="object"){const i=e.game.roundWinners;Object.keys(i).forEach(o=>{const l=i[o];l===n?i[o]=s:l===s&&(i[o]=n)})}typeof x.editingPlayerIdx=="number"&&(x.editingPlayerIdx===n?x.editingPlayerIdx=s:x.editingPlayerIdx===s&&(x.editingPlayerIdx=n)),e.save(),f.all()},addPlayerFrom(t){const a=document.getElementById(t);if(!a)return;if(e.game.locked===!0){w("O jogo já começou. Não é possível adicionar participantes agora.");return}if(e.game.players.length>=I.MAX_PLAYERS){w(`Limite de ${I.MAX_PLAYERS} jogadores atingido.`);return}const n=a.value.trim();if(!n)return;const s=20,r=n.length>s?n.substring(0,s):n;for(e.game.players.push(r),e.game.rounds.forEach(i=>i.push(""));e.game.rounds.length<e.game.players.length;)e.game.rounds.push(new Array(e.game.players.length).fill(""));a.value="",e.save(),f.all()},handleEnterFrom(t,a){t.key==="Enter"&&this.addPlayerFrom(a)},toggleTimer(){if(e.timer.r){v.toggle();return}if(!e.isGameStarted()&&e.game.players.length>0&&e.game.currIdx===0&&e.game.editingIdx===null){A("Iniciar a 1ª rodada?","Ao iniciar, não será mais possível adicionar participantes e os campos serão liberados.",()=>{e.startGame(),f.updateAddPlayerState(),v.toggle()});return}v.toggle()},startFirstRound(){if(!e.isGameStarted()){if(e.game.players.length<I.MIN_PLAYERS){w(`Adicione pelo menos ${I.MIN_PLAYERS} jogadores para iniciar.`);return}A("Iniciar a 1ª rodada?","Ao iniciar, não será mais possível adicionar participantes e os campos serão liberados.",()=>{e.startGame(),f.all()})}},beginEditPlayer(t){x.editingPlayerIdx=t,f.playersManager()},cancelEditPlayer(){x.editingPlayerIdx=null,f.playersManager()},savePlayerName(t){const a=document.getElementById(`playerNameInput-${t}`);if(!a)return;const n=a.value.trim(),s=(e.game.players[t]||"").trim();if(!n){w("O nome não pode ficar vazio."),a.value=s;return}if(n===s){x.editingPlayerIdx=null,f.playersManager();return}A("Trocar nome do jogador?",`De: ${s}
Para: ${n}`,()=>{e.game.players[t]=n,e.save(),x.editingPlayerIdx=null,f.all()})},removePlayer(t){const a=e.game.players[t];if(a){if(e.isGameStarted()){w("A partida já começou. Para remover jogadores, reinicie o jogo.");return}if(e.game.players.length<=I.MIN_PLAYERS){w(`Mínimo de ${I.MIN_PLAYERS} jogadores. Para remover mais, reinicie o jogo.`);return}A("Remover jogador?",`Remover ${a}? Isso também ajusta a tabela de rodadas.`,()=>{for(e.game.players.splice(t,1),e.game.rounds.forEach(n=>{Array.isArray(n)&&n.splice(t,1)});e.game.rounds.length>e.game.players.length;)e.game.rounds.pop();e.game.rounds.forEach(n=>{Array.isArray(n)&&(n.length=e.game.players.length)}),x.editingPlayerIdx=null,e.save(),f.all()})}},addPlayer(){this.addPlayerFrom("newPlayerName")},handleEnter(t){t.key==="Enter"&&this.addPlayer()},toggleLeaderboardExpanded(){x.leaderboardExpanded=!x.leaderboardExpanded,f.leaderboard()},toggleLeaderboardOpen(){x.leaderboardOpen=!x.leaderboardOpen,f.leaderboard()},applyScoreValue(t,a,n,s,r={}){e.game.rounds[t][a]=s;const i=`${t}-${a}`;e.game.tileDetails||(e.game.tileDetails={}),Array.isArray(r.tileCounts)&&r.tileCounts.length===14?e.game.tileDetails[i]=r.tileCounts.map(l=>typeof l=="number"?l:0):delete e.game.tileDetails[i],e.save();const o=parseInt(s);if(n.className=n.className.replace(/text-\w+-\d+/g,""),isNaN(o))n.classList.add("text-slate-800");else if(o>0)n.classList.add("text-emerald-600");else if(o<0)n.classList.add("text-rose-600");else{const l=e.game.roundWinners?e.game.roundWinners[t]:null;typeof l=="number"&&l===a?n.classList.add("text-emerald-600"):n.classList.add("text-slate-400")}f.totals(),f.leaderboard(),f.updateAddPlayerState(),r.skipRecalc!==!0&&this.recalculateWinnerForRound(t,a)},recalculateWinnerForRound(t,a){if(!e.game.roundWinners)return;const n=e.game.roundWinners[t];if(typeof n!="number"||typeof a=="number"&&a===n)return;const s=e.game.rounds[t];if(!Array.isArray(s))return;let r=0;for(let l=0;l<s.length;l++){if(l===n)continue;const m=s[l];if(m===""||m===null||typeof m>"u")continue;const d=parseInt(m);isNaN(d)||(r+=d)}const i=(-r).toString(),o=document.getElementById(`cell-${t}-${n}`);o?(o.value=i,this.applyScoreValue(t,n,o,i,{skipRecalc:!0})):(e.game.rounds[t][n]=i,e.save(),f.totals(),f.leaderboard())},handleInput(t,a,n){if(!e.isGameStarted()&&e.game.editingIdx===null){w("Inicie a 1ª rodada para lançar os valores."),n.value="";return}let s=n.value;/^\d+$/.test(s)&&(s="-"+s,n.value=s),this.applyScoreValue(t,a,n,s)},openTileCalc(t,a){if(!e.isGameStarted()&&e.game.editingIdx===null){w("Inicie a 1ª rodada para lançar os valores.");return}const n=e.game.editingIdx===t,s=e.game.editingIdx===null&&e.game.currIdx===t;if(!n&&!s){w("Essa rodada está bloqueada. Use o ícone de edição para alterar.");return}j.open(t,a)},handleSmartAction(){if(!e.isGameStarted()){this.startFirstRound();return}if(e.game.editingIdx===null&&e.game.currIdx>=e.game.rounds.length){N();return}if(e.game.players.length<2)return alert("Adicione jogadores.");const t=e.game.editingIdx!==null?e.game.editingIdx:e.game.currIdx,a=e.game.rounds[t];let n=[],s=0,r=!1,i=0,o=0;if(a.forEach((l,m)=>{if(l===""||l===null)n.push(m);else{const d=parseInt(l);isNaN(d)?r=!0:(s+=d,d>0?i+=d:o+=d)}}),r)return alert("Valores inválidos.");if(n.length===0){s!==0?Y(s,i,o):e.game.editingIdx!==null?A("Salvar Alterações?","A soma está correta (0).",()=>this.finishAction(t)):A("Concluir Rodada?","A soma está correta (0).",()=>this.finishAction(t));return}if(n.length===1){const l=s*-1;e.game.players[n[0]],J(t,n[0],l);return}w("Erro: Mais de um jogador vazio. Preencha todos os perdedores.")},finishAction(t){const a=e.game.editingIdx!==null,n=e.isGameStarted()&&e.game.currIdx>=e.game.rounds.length;a?e.game.editingIdx=null:e.game.currIdx<e.game.rounds.length&&e.game.currIdx++;const s=!a&&!n&&e.isGameStarted()&&e.game.currIdx>=e.game.rounds.length;e.save(),f.all(),s&&N(),a&&e.isGameStarted()&&e.game.currIdx>=e.game.rounds.length&&N()},enableEdit(t){A("Editar Rodada Anterior?","A rodada atual será bloqueada temporariamente.",()=>{e.game.editingIdx=t,e.save(),f.all()})},switchTab(t){document.querySelectorAll(".nav-link").forEach(a=>a.classList.remove("active")),document.getElementById(`nav-${t}`).classList.add("active"),document.getElementById("tab-game").classList.toggle("hidden",t!=="game"),document.getElementById("tab-players").classList.toggle("hidden",t!=="players"),document.getElementById("tab-rules").classList.toggle("hidden",t!=="rules"),document.getElementById("tab-about").classList.toggle("hidden",t!=="about")},openTimerSettings(){document.getElementById("timerModal").classList.remove("hidden");const t=Math.round(e.timer.d/60);document.getElementById("customDuration").value=t,document.getElementById("soundToggle").checked=e.timer.s;const a=e.game.timeRule||(t===1?"official":t===2?"alternative":"custom"),n=document.querySelector(`input[name="timeRule"][value="${a}"]`);n&&(n.checked=!0),document.getElementById("autoRotateToggle").checked=e.game.turnAutoRotate!==!1,document.getElementById("confirmOnExpiry").checked=e.game.confirmExpiry===!0},closeTimerSettings(){document.getElementById("timerModal").classList.add("hidden")},setTempDuration(t){document.getElementById("customDuration").value=t},saveTimerSettings(){const t=document.querySelector('input[name="timeRule"]:checked'),a=t?t.value:"custom",n=document.getElementById("customDuration").value,s=parseInt(n);let r=60;if(a==="official")r=60;else if(a==="alternative")r=120;else if(a==="impatient")r=30;else if(a==="custom"){if(Number.isNaN(s)){w("Informe um número de minutos válido.");return}if(s<1||s>=60){w("O tempo deve ser maior ou igual a 1 e menor que 60 minutos.");return}r=s*60}e.timer.d=r,e.timer.s=document.getElementById("soundToggle").checked,e.game.timeRule=a,e.game.turnAutoRotate=document.getElementById("autoRotateToggle").checked,e.game.confirmExpiry=document.getElementById("confirmOnExpiry").checked===!0,e.saveTimer(),e.save(),v.reset(),this.closeTimerSettings()},rotateToNextPlayer(){!Array.isArray(e.game.players)||e.game.players.length===0||(this.endCurrentTurn("rotate"),e.game.turnIdx=(typeof e.game.turnIdx=="number"?e.game.turnIdx:0)+1,e.game.turnIdx=e.game.turnIdx%e.game.players.length,e.save(),this.startCurrentTurn(),f.playersManager(),v.updateUI())},confirmSkipTurn(){const t=typeof e.game.turnIdx=="number"?e.game.turnIdx:0,a=e.game.players[t]||`Jogador ${t+1}`;A("Pular turno?",`Deseja pular o turno de ${a}?`,()=>{this.skipTurn()})},skipTurn(){const t=e.timer.r;this.rotateToNextPlayer(),v.reset(),(t||e.game.turnAutoRotate)&&v.start(),H("Turno pulado manualmente por ação do usuário.")}};let C=null;function A(t,a,n){const s=document.getElementById("confirmTitle"),r=document.getElementById("confirmMsg");s&&(s.innerText=t),r&&(r.innerText=a),C=n;const i=document.getElementById("confirmModal");i&&i.classList.remove("hidden")}function _(){const t=document.getElementById("confirmModal");t&&t.classList.add("hidden"),C=null}function G(){C&&C(),_()}function F(t,a=4500){const n=document.getElementById("toastContainer");if(!n)return;const s=document.createElement("div");s.className="toast px-4 py-2 rounded-xl shadow-lg bg-slate-900 text-white text-sm mb-2",s.innerText=t,n.appendChild(s),setTimeout(()=>{s.classList.add("toast-fade"),setTimeout(()=>{try{n.removeChild(s)}catch{}},300)},a)}function H(t){try{const a=new Date().toISOString();Array.isArray(e.game.events)||(e.game.events=[]),e.game.events.unshift({ts:a,msg:t}),e.game.events.length>200&&(e.game.events.length=200),e.save(),f.eventLog()}catch(a){console.warn("Erro ao registrar evento",a)}}function N(){const t=new Array(e.game.players.length).fill(0);(e.game.rounds||[]).forEach(d=>{Array.isArray(d)&&d.forEach((c,h)=>{const u=parseInt(c);isNaN(u)||(t[h]+=u)})});const a=t.map((d,c)=>({i:c,n:e.game.players[c],s:d})).sort((d,c)=>c.s-d.s||d.i-c.i),n=a.length?a[0]:null,s=document.getElementById("gameOverTitle"),r=document.getElementById("gameOverSubtitle"),i=document.getElementById("gameOverRanking");n?(s&&(s.textContent=`Parabéns, ${n.n}!`),r&&(r.textContent="Vencedor(a) da partida. Classificação final:")):(s&&(s.textContent="Jogo finalizado!"),r&&(r.textContent="Classificação final:"));let o="";const l='<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor" class="w-4 h-4 trophy-icon" aria-hidden="true"><path d="M10 2a.75.75 0 01.75.75v.846a4.5 4.5 0 003.66 4.411.75.75 0 01.64.74v1.003a4.5 4.5 0 01-3.155 4.29l-.695.232a.75.75 0 00-.51.711V16.5h1.5a.75.75 0 010 1.5h-5a.75.75 0 010-1.5h1.5v-1.525a.75.75 0 00-.51-.711l-.695-.232A4.5 4.5 0 015.5 9.75V8.747a.75.75 0 01.64-.74 4.5 4.5 0 003.66-4.411V2.75A.75.75 0 0110 2z" /><path d="M4.5 5.75a.75.75 0 00-1.5 0v2A2.75 2.75 0 005.75 10.5h.392a6.023 6.023 0 01-.439-1.5H5.75A1.25 1.25 0 014.5 7.75v-2zM15.5 5.75a.75.75 0 011.5 0v2a2.75 2.75 0 01-2.75 2.75h-.392c.216-.48.364-.98.439-1.5h-.047A1.25 1.25 0 0015.5 7.75v-2z" /></svg>';a.forEach((d,c)=>{const h=c===0,b=h?"bg-yellow-100 border-yellow-200 text-yellow-800":c===1?"bg-slate-100 border-slate-200 text-slate-700":c===2?"bg-orange-100 border-orange-200 text-orange-800":"bg-slate-100 border-slate-200 text-slate-600",p=d.s>0?"text-emerald-600":d.s<0?"text-rose-600":"text-slate-400",y=d.s>0?"+":"",E=h?l:`<span class="text-xs font-black tabular-nums">${c+1}</span>`;o+=`
      <div class="w-full rounded-lg border border-slate-200 bg-white px-2 py-1.5">
        <div class="flex items-center justify-between gap-3">
          <div class="flex items-center gap-2 min-w-0">
            <div class="w-6 h-6 rounded-md border ${b} flex items-center justify-center shrink-0">
              ${E}
            </div>
            <div class="text-xs font-bold text-slate-800 truncate min-w-0">${d.n}</div>
          </div>
          <div class="text-xs font-black tabular-nums ${p}">${y}${d.s}</div>
        </div>
      </div>
    `}),i&&(i.innerHTML=o);const m=document.getElementById("gameOverModal");m&&m.classList.remove("hidden")}function w(t){const a=document.getElementById("errorModalMsg");a&&(a.innerText=t);const n=document.getElementById("errorModal");n&&n.classList.remove("hidden")}function Y(t,a,n){const s=document.getElementById("errorModal"),r=document.getElementById("errorModalMsg");r&&(r.innerHTML=`<div class="space-y-3"><p>A soma deve ser zero.</p><div class="flex justify-between text-xs font-bold uppercase bg-slate-50 p-3 rounded-lg border border-slate-200"><div class="text-emerald-600 text-center">Positivos<br><span class="text-lg">+${a}</span></div><div class="text-rose-600 text-center">Negativos<br><span class="text-lg">${n}</span></div></div><div class="bg-red-50 p-2 rounded-lg text-center"><p class="text-xs font-bold text-red-800 uppercase mb-1">Diferença</p><p class="text-2xl font-black text-red-600">${t>0?"+":""}${t}</p></div></div>`),s&&s.classList.remove("hidden")}function J(t,a,n){const s=e.game.players&&e.game.players[a]||"",r=document.getElementById("modalWinnerName"),i=document.getElementById("modalWinnerScore"),o=document.getElementById("modalWinnerBadge"),l=document.getElementById("winnerModalMsg"),m=document.getElementById("winnerModal"),d=document.getElementById("confirmWinnerBtn");r&&(r.textContent=s);const c=`${n>0?"+":""}${n}`;i&&(i.textContent=c),o&&(o.textContent=c,o.classList.remove("bg-emerald-600","bg-rose-600"),o.classList.add(n>=0?"bg-emerald-600":"bg-rose-600"),o.classList.remove("badge-pulse"),o.offsetWidth,o.classList.add("badge-pulse"),setTimeout(()=>o.classList.remove("badge-pulse"),700)),l&&(l.textContent=`Pontos calculados: ${c}. Confirme para aplicar e encerrar a rodada.`),m&&m.classList.remove("hidden"),d&&d.focus&&d.focus(),typeof L<"u"&&L.tick&&L.tick()}const W=document.getElementById("confirmBtnAction");W&&(W.onclick=G);if(typeof window<"u")try{window.State=e,window.Timer=v,window.Actions=typeof B<"u"?B:void 0,typeof f<"u"&&(window.Render=f)}catch{}typeof window<"u"&&(window.State=e,window.Timer=v,window.Actions=B,window.TileCalc=j,window.Render=f,window.UI=x,window.Sound=L,window.GameLimits=I);e.init();v.updateUI();typeof f<"u"&&f&&typeof f.all=="function"&&f.all();const R=document.createElement("div");R.id="toastContainer";R.className="fixed bottom-6 right-6 z-50";document.body.appendChild(R);
